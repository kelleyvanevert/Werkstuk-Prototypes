\chapter{Syntaxis}

\section{Grammatica}

\begin{grammar}
<Statement>  ::= <Statement> ";" <Statement>
            \alt @skip@
            \alt @if@ <Test> <Statement> @else@ <Statement>
            \alt @while@ <Test> <Statement>
            \alt @print@ <Expression>
            \alt @var@ <Slots> 
            \alt <Slot> "=" <Expression>
            \alt @fun@ <Slot> "(" <Identifiers>? ")" [@returns@ <Slot>] <Statement>
            \alt [<Slot> "="] <Slot> "(" <Expressions>? ")"
            \alt @obj@ <Slot> [@clones@ <Slot>]

<Slot>       ::= <Identifier> | <Identifier> "." <Slot>

<Slots>       ::= <Slot> | <Slot> "," <Slots>

<Identifier> ::= ( "a" | \dots | "z" | "A" | \dots | "Z" | "_" )+

<Identifiers> ::= <Identifier> | <Identifier> "," <Identifiers>

<Expression> ::= <Number>
            \alt <Slot>
            \alt <Expression> <Operator> <Expression>

<Expressions> ::= <Expression> | <Expression> "," <Expressions>

<Operator>   ::= "+" | "-" | "*" | "/" | "\%"

<Number>     ::= ( "0" | \dots | "9" )+

<Test>       ::= <Boolean>
            \alt <Test> "\&" <Test>
            \alt <Test> "|"  <Test>
            \alt "~" <Test>
            \alt <Expression> <Relation> <Expression>

<Relation>   ::= "==" | "/=" | "<" | "<=" | ">" | ">="

<Boolean>    ::= @true@ | @false@
\end{grammar}

\section{Een programma over deuren}

\begin{program}
obj Door clones Object       // Maak een nieuwe deur

fun Door.open()              // Een functie om de deur te openen
    print 42

obj LockedDoor clones Door   // Maak een nieuwe gesloten deur...
var LockedDoor.isLocked
LockedDoor.isLocked = 1      // ...die dicht is

fun LockedDoor.unlock(code)
    if code == this.code     // Als de code correct is...
        isLocked = 0         // ...openen we de deur

fun LockedDoor.open()        // Herdefinieer om isLocked te gebruiken
    if isLocked == 1
        print 0
    else
        proto.open()         // Expliciete aanroep naar prototype

obj Safe clones LockedDoor   // Maak een kluis...
var Safe.code
Safe.code = 1234             // ...en ken een code toe

Safe.unlock(4321)
Safe.open()                  // Geeft 0, de deur is gesloten
Safe.unlock(1234)
Safe.open()                  // Geeft 42, we de juiste code hadden
\end{program}

\section{Een programma over personen}

\begin{program}
obj Person clones Object

var Person.total
Person.total = 0

fun Person.initialize()      // Wordt aangeroepen bij iedere kloon
    Person.total = Person.total + 1

obj Me clones Person
var Me.age
Me.age = 37

obj You clones Person
var You.age
You.age = 42

print Person.total           // Geeft 2
\end{program}

\section{Een programma over scope}

\begin{program}
var x
x = 1
fun g()
    print x
    x = 2
fun f()
    var x
    x = 3
    g()
f()
print x
\end{program}

\section{Een programma over counters}

\begin{minipage}{0.5\textwidth}
\begin{program}
fun counter(n) returns next

    fun next() returns n
        n = n + 1

var c
c = counter(5)

var d
d = counter(42)

var i, j
i = c() // i = 6
j = d() // j = 43
\end{program}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{program}
obj Counter clones Object
var Counter.n
fun Counter.next()
    n = n + 1

obj c clones Counter
c.n = 5

obj d clones Counter
d.n = 42


c.next() // c.n = 6
d.next() // d.n = 43
\end{program}
\end{minipage}

% vim: spell spl=nl
